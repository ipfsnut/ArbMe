[phases.setup]
nixPkgs = ["nodejs_20"]

[phases.install]
cmds = [
  "npm ci"
]

[phases.build]
cmds = [
  "echo 'ğŸ”¨ Building core-lib...'",
  "npm run build --workspace=@arbme/core-lib",
  "echo 'âœ… core-lib built'",
  "echo 'ğŸ”¨ Building Next.js app...'",
  "npm run build --workspace=@arbme/nextjs",
  "echo 'âœ… Next.js built'",
  "echo 'ğŸ“ Checking build output...'",
  "ls -la packages/nextjs/.next/ || (echo 'âŒ ERROR: No .next directory created!' && exit 1)",
  "ls -la packages/nextjs/.next/standalone/ || (echo 'âŒ ERROR: No standalone directory!' && exit 1)",
  "test -f packages/nextjs/.next/standalone/packages/nextjs/server.js || (echo 'âŒ ERROR: server.js not created!' && exit 1)",
  "echo 'âœ… server.js exists'",
  "echo 'ğŸ“¦ Copying static files...'",
  "cp -r packages/nextjs/.next/static packages/nextjs/.next/standalone/packages/nextjs/.next/static",
  "echo 'âœ… Build complete!'"
]

[start]
cmd = "npm run server --workspace=arbme-market-maker-bot"
